package gtne.common.metatileentities.multi.spaceelevator;

import appeng.core.localization.GuiText;
import codechicken.lib.render.CCRenderState;
import codechicken.lib.render.pipeline.IVertexOperation;
import codechicken.lib.vec.Matrix4;
import gregtech.api.capability.IEnergyContainer;
import gregtech.api.capability.IOpticalComputationHatch;
import gregtech.api.capability.IOpticalComputationProvider;
import gregtech.api.capability.impl.EnergyContainerList;
import gregtech.api.gui.GuiTextures;
import gregtech.api.gui.ModularUI;
import gregtech.api.gui.widgets.AdvancedTextWidget;
import gregtech.api.gui.widgets.ClickButtonWidget;
import gregtech.api.gui.widgets.ImageCycleButtonWidget;
import gregtech.api.gui.widgets.ImageWidget;
import gregtech.api.metatileentity.MetaTileEntity;
import gregtech.api.metatileentity.interfaces.IGregTechTileEntity;
import gregtech.api.metatileentity.multiblock.IMultiblockPart;
import gregtech.api.metatileentity.multiblock.MultiblockAbility;
import gregtech.api.metatileentity.multiblock.MultiblockDisplayText;
import gregtech.api.metatileentity.multiblock.MultiblockWithDisplayBase;
import gregtech.api.pattern.BlockPattern;
import gregtech.api.pattern.FactoryBlockPattern;
import gregtech.api.pattern.PatternMatchContext;
import gregtech.api.pattern.TraceabilityPredicate;
import gregtech.api.util.Mods;
import gregtech.api.util.TextComponentUtil;
import gregtech.client.renderer.ICubeRenderer;
import gregtech.client.renderer.texture.Textures;
import gtne.api.blocks.IElevatorMotorTier;
import gtne.api.metatileentity.interfaces.ISpaceElevatorProvider;
import gtne.api.metatileentity.interfaces.ISpaceElevatorReceiver;
import gtne.client.GTNETextures;
import gtne.common.Block.GTNEMetaBlock;
import gtne.common.Block.elevator.ElevatorCasing;
import micdoodle8.mods.galacticraft.core.entities.player.GCPlayerStats;
import micdoodle8.mods.galacticraft.core.util.WorldUtil;
import net.minecraft.block.Block;
import net.minecraft.block.state.IBlockState;
import net.minecraft.entity.player.EntityPlayer;
import net.minecraft.entity.player.EntityPlayerMP;
import net.minecraft.nbt.NBTTagCompound;
import net.minecraft.network.PacketBuffer;
import net.minecraft.tileentity.TileEntity;
import net.minecraft.util.ResourceLocation;
import net.minecraft.util.text.ITextComponent;
import net.minecraft.util.text.TextFormatting;
import net.minecraftforge.fml.relauncher.Side;
import net.minecraftforge.fml.relauncher.SideOnly;
import org.jetbrains.annotations.NotNull;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.List;
import java.util.concurrent.ConcurrentHashMap;

import static gregtech.api.unification.material.Materials.Neutronium;
import static gregtech.api.util.RelativeDirection.*;
import static gtne.api.pattern.TraceAbilityPredicates.elevatorMotors;

public class MetaTileEntitySpaceElevator extends MultiblockWithDisplayBase implements ISpaceElevatorProvider {

    protected IEnergyContainer energyContainer;

    protected IOpticalComputationProvider computationProvider;

    protected int motorTier = 0;

    private boolean isExtended = false;

    private final Collection<ISpaceElevatorReceiver> spaceElevatorReceivers = ConcurrentHashMap.newKeySet(); //TODO fix by using iterator on modification

    public MetaTileEntitySpaceElevator(ResourceLocation metaTileEntityId) {
        super(metaTileEntityId);
    }

    @Override
    public MetaTileEntity createMetaTileEntity(IGregTechTileEntity iGregTechTileEntity) {
        return new MetaTileEntitySpaceElevator(metaTileEntityId);
    }

    @Override
    public void update() {
        super.update();
        if (!isStructureFormed()) {
            this.spaceElevatorReceivers.forEach(ISpaceElevatorReceiver::sentWorkingDisabled);
        }
    }

    @Override
    protected void updateFormedValid() {
        if (!this.spaceElevatorReceivers.isEmpty()) {
            if (!checkModules()) {
                invalidateStructure();
            }
        }
        if (this.getOffsetTimer() % 20 == 0) {
            this.spaceElevatorReceivers.forEach(s -> {
                if (s.getSpaceElevator() == null)
                    this.spaceElevatorReceivers.remove(s);
            });
        }
    }

    @Override
    protected @NotNull BlockPattern createStructurePattern() {
        if (!this.isExtended) {
            return FactoryBlockPattern.start(RIGHT, DOWN, FRONT)
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "               FF FF               ", "               AAAAA               ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "               D   D               ", "            FFFFF FFFFF            ", "            AAAAAAAAAAA            ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "            DDDDE EDDDD            ", "          FFFFFFF FFFFFFF          ", "          AAAAAAAAAAAAAAA          ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "          DD   DE ED   DD          ", "         FFFFFFD   DFFFFFF         ", "        AAAAAAAAAAAAAAAAAAA        ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               D   D               ", "         FFF           FFF         ", "       AAAAAAAAAAAAAAAAAAAAA       ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "      AAAAAAAAAAAAAAAAAAAAAAA      ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "                                   ", "     AAAAAAAAAAAAAAAAAAAAAAAAA     ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "              HDE EDH              ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "    AAAAAAAAAAAAAAAAAAAAAAAAAAA    ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "            HH DE ED HH            ", "                                   ", "                                   ", "                                   ", "                                   ", "               V V V               ", "               V V V               ", "               V V V               ", "               V V V               ", "   AAAAAAAAAAAAV V VAAAAAAAAAAAA   ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "         E               E         ", "         EHH           HHE         ", "         E               E         ", "         E               E         ", "         E               E         ", "         E               E         ", "         E     V V V     E         ", "         E     I I I     E         ", "         E     V V V     E         ", "   FF    E     V V V     E    FF   ", "   AAAAAAAAAAAAV V VAAAAAAAAAAAA   ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "          E             E          ", "          E             E          ", "          E             E          ", "          E             E          ", "          E             E          ", "         HE             EH         ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "   D                           D   ", "  FFF          F F F          FFF  ", "  AAAAAAAAAAAAA     AAAAAAAAAAAAA  ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "           E           E           ", "           E           E           ", "           E           E           ", "           E           E           ", "           E           E           ", "                                   ", "                                   ", "         H               H         ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "   D                           D   ", "  FFF          F F F          FFF  ", "  AAAAAAAAAAAAA     AAAAAAAAAAAAA  ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "             HH     HH             ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "        H                 H        ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "  D                             D  ", " FFF          FFFFFFF          FFF ", " AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                FFF                ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "             E       E             ", "             E       E             ", "             E       E             ", "             E       E             ", "             E       E             ", "             E       E             ", "             E       E             ", "            HE       EH            ", "             E       E             ", "             E       E             ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "        H                 H        ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "  D                             D  ", " FFF         FFFFFFFFF         FFF ", " AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                    .aisle("                FFF                ", "                 E                 ", "                 E                 ", "                 E                 ", "                 E                 ", "                 E                 ", "               F   F               ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "                                   ", "                                   ", "                FFF                ", "                                   ", "                                   ", "            H         H            ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                FFF                ", "                                   ", "                                   ", "                                   ", "                                   ", "       H                   H       ", "                                   ", "                                   ", "                                   ", "                                   ", "                XXX                ", "                X~X                ", "  D             XXX             D  ", " FFF        FFFFFFFFFFF        FFF ", " AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                    .aisle("               F D F               ", "                 D                 ", "                 D                 ", "                 D                 ", "                 D                 ", "                 D                 ", "              F  D  F              ", "                 D                 ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "           DD    D    DD           ", "           D     D     D           ", "           D     D     D           ", "           D   F D F   D           ", "           D     C     D           ", "           D     C     D           ", "           D     C     D           ", "           D     C     D           ", "          DD     C     DD          ", "          D      C      D          ", "          D      C      D          ", "          D      C      D          ", "         DD      C      DD         ", "         D     FDCDF     D         ", "         D      DCD      D         ", "        DD      DCD      DD        ", "        D       DCD       D        ", "        D       DCD       D        ", "       DD      DDCDD      DD       ", "       D       D C D       D       ", "       D       D C D       D       ", "      DD       D C D       DD      ", "      D        D C D        D      ", "     DD VV     XDCDX     VV DD     ", "    DD  VI     XDCDX     IV  DD    ", " DDDD   VV     XDCDX     VV   DDDD ", "FFFD    VVFFFFFDDDDDFFFFFVV    DFFF", "AAAAAAAAVV  AAAXXXXXAAA  VVAAAAAAAA")
                    .aisle("              F     F              ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "             F       F             ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "           EE         EE           ", "           EE         EE           ", "           E           E           ", "           E           E           ", "           E  F     F  E           ", "           E           E           ", "           E           E           ", "           E           E           ", "          EE           EE          ", "          EE           EE          ", "          E             E          ", "          E             E          ", "         EE             EE         ", "         EE             EE         ", "         E    FD   DF    E         ", "        EE     D   D     EE        ", "        EE     D   D     EE        ", "        E      D   D      E        ", "       EE      D   D      EE       ", "       EE      D   D      EE       ", "       E                   E       ", "      EE                   EE      ", "      EE                   EE      ", "     EE                     EE     ", "    EEE       XD   DX       EEE    ", "   EEE        XD   DX        EEE   ", "  EE          XD   DX          EE  ", "FFF         FFFDDDDDFFF         FFF", "AAAAAAAA    AAAXXXXXAAA    AAAAAAAA")
                    .aisle("              FD   DF              ", "              ED   DE              ", "              ED   DE              ", "              ED   DE              ", "              ED   DE              ", "              ED   DE              ", "             F D   D F             ", "               D   D               ", "               D   D               ", "               D   D               ", "               D   D               ", "               D   D               ", "               D   D               ", "               D   D               ", "               D   D               ", "               D   D               ", "               D   D               ", "               D B D               ", "              FD - DF              ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "              FC - CF              ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "               C - C               ", "        VV    XC - CX    VV        ", "        VI    XC - CX    IV        ", "        VV    XC - CX    VV        ", "        VVFFFFFDDDDDFFFFFVV        ", "AAAAAAAAVV  AAAXXXXXAAA  VVAAAAAAAA")
                    .aisle("              F     F              ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "             F       F             ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "           EE         EE           ", "           EE         EE           ", "           E           E           ", "           E           E           ", "           E  F     F  E           ", "           E           E           ", "           E           E           ", "           E           E           ", "          EE           EE          ", "          EE           EE          ", "          E             E          ", "          E             E          ", "         EE             EE         ", "         EE             EE         ", "         E    FD   DF    E         ", "        EE     D   D     EE        ", "        EE     D   D     EE        ", "        E      D   D      E        ", "       EE      D   D      EE       ", "       EE      D   D      EE       ", "       E                   E       ", "      EE                   EE      ", "      EE                   EE      ", "     EE                     EE     ", "    EEE       XD   DX       EEE    ", "   EEE        XD   DX        EEE   ", "  EE          XD   DX          EE  ", "FFF         FFFDDDDDFFF         FFF", "AAAAAAAA    AAAXXXXXAAA    AAAAAAAA")
                    .aisle("               F D F               ", "                 D                 ", "                 D                 ", "                 D                 ", "                 D                 ", "                 D                 ", "              F  D  F              ", "                 D                 ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "            D    D    D            ", "           DD    D    DD           ", "           D     D     D           ", "           D     D     D           ", "           D   F D F   D           ", "           D     C     D           ", "           D     C     D           ", "           D     C     D           ", "           D     C     D           ", "          DD     C     DD          ", "          D      C      D          ", "          D      C      D          ", "          D      C      D          ", "         DD      C      DD         ", "         D     FDCDF     D         ", "         D      DCD      D         ", "        DD      DCD      DD        ", "        D       DCD       D        ", "        D       DCD       D        ", "       DD      DDCDD      DD       ", "       D       D C D       D       ", "       D       D C D       D       ", "      DD       D C D       DD      ", "      D        D C D        D      ", "     DD VV     XDCDX     VV DD     ", "    DD  VI     XDCDX     IV  DD    ", " DDDD   VV     XDCDX     VV   DDDD ", "FFFD    VVFFFFFDDDDDFFFFFVV    DFFF", "AAAAAAAAVV  AAAXXXXXAAA  VVAAAAAAAA")
                    .aisle("                FFF                ", "                 E                 ", "                 E                 ", "                 E                 ", "                 E                 ", "                 E                 ", "               F   F               ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "              E     E              ", "                                   ", "                                   ", "                FFF                ", "                                   ", "                                   ", "            H         H            ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                FFF                ", "                                   ", "                                   ", "                                   ", "                                   ", "       H                   H       ", "                                   ", "                                   ", "                                   ", "                                   ", "                XXX                ", "                XXX                ", "  D             XXX             D  ", " FFF        FFFFFFFFFFF        FFF ", " AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                FFF                ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "             E       E             ", "             E       E             ", "             E       E             ", "             E       E             ", "             E       E             ", "             E       E             ", "             E       E             ", "            HE       EH            ", "             E       E             ", "             E       E             ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "        H                 H        ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "  D                             D  ", " FFF         FFFFFFFFF         FFF ", " AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "             HH     HH             ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "            E         E            ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "        H                 H        ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "  D                             D  ", " FFF          FFFFFFF          FFF ", " AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "           E           E           ", "           E           E           ", "           E           E           ", "           E           E           ", "           E           E           ", "                                   ", "                                   ", "         H               H         ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "   D                           D   ", "  FFF          F F F          FFF  ", "  AAAAAAAAAAAAA     AAAAAAAAAAAAA  ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "          E             E          ", "          E             E          ", "          E             E          ", "          E             E          ", "          E             E          ", "         HE             EH         ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "   D                           D   ", "  FFF          F F F          FFF  ", "  AAAAAAAAAAAAA     AAAAAAAAAAAAA  ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "         E               E         ", "         EHH           HHE         ", "         E               E         ", "         E               E         ", "         E               E         ", "         E               E         ", "         E     V V V     E         ", "         E     I I I     E         ", "         E     V V V     E         ", "   FF    E     V V V     E    FF   ", "   AAAAAAAAAAAAV V VAAAAAAAAAAAA   ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "            HH DE ED HH            ", "                                   ", "                                   ", "                                   ", "                                   ", "               V V V               ", "               V V V               ", "               V V V               ", "               V V V               ", "   AAAAAAAAAAAAV V VAAAAAAAAAAAA   ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "              HDE EDH              ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "    AAAAAAAAAAAAAAAAAAAAAAAAAAA    ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "                                   ", "     AAAAAAAAAAAAAAAAAAAAAAAAA     ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               DE ED               ", "                                   ", "                                   ", "      AAAAAAAAAAAAAAAAAAAAAAA      ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "               DE ED               ", "               D   D               ", "         FFF           FFF         ", "       AAAAAAAAAAAAAAAAAAAAA       ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                E E                ", "          DD   DE ED   DD          ", "         FFFFFFD   DFFFFFF         ", "        AAAAAAAAAAAAAAAAAAA        ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "            DDDDE EDDDD            ", "          FFFFFFF FFFFFFF          ", "          AAAAAAAAAAAAAAA          ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "               D   D               ", "            FFFFF FFFFF            ", "            AAAAAAAAAAA            ")
                    .aisle("                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "                                   ", "               FF FF               ", "               AAAAA               ")
                    .where(' ', any())
                    .where('-', air())
                    .where('~', selfPredicate())
                    .where('D', states(GTNEMetaBlock.ELEVATOR_CASING.getState(ElevatorCasing.CasingType.ELEVATOR_BASE_CASING)))
                    .where('F', states(GTNEMetaBlock.ELEVATOR_CASING.getState(ElevatorCasing.CasingType.ELEVATOR_INTERNAL_STRUCTURE)))
                    .where('E', states(GTNEMetaBlock.ELEVATOR_CASING.getState(ElevatorCasing.CasingType.ELEVATOR_SUPPORT_STRUCTURE)))
                    .where('A', states(GTNEMetaBlock.ELEVATOR_CASING.getState(ElevatorCasing.CasingType.HIGH_STRENGTH_CONCRETE)))
                    .where('B', states(GTNEMetaBlock.ELEVATOR_CASING.getState(ElevatorCasing.CasingType.ELEVATOR_CABLE)))
                    .where('H', frames(Neutronium))
                    .where('X', states(GTNEMetaBlock.ELEVATOR_CASING.getState(ElevatorCasing.CasingType.ELEVATOR_BASE_CASING)).or(abilities(MultiblockAbility.INPUT_ENERGY, MultiblockAbility.INPUT_LASER).setExactLimit(1)).or(abilities(MultiblockAbility.COMPUTATION_DATA_RECEPTION).setExactLimit(1)))
                    .where('C', elevatorMotors())
                    .where('I', modulePredicate())
                    .where('V', states(GTNEMetaBlock.ELEVATOR_CASING.getState(ElevatorCasing.CasingType.ELEVATOR_BASE_CASING)).or(abilities(MultiblockAbility.IMPORT_ITEMS,MultiblockAbility.IMPORT_FLUIDS,MultiblockAbility.EXPORT_FLUIDS,MultiblockAbility.EXPORT_ITEMS, MultiblockAbility.COMPUTATION_DATA_RECEPTION).setPreviewCount(0)))
                    .build();
        }
        else {
            return FactoryBlockPattern.start(RIGHT, DOWN, FRONT)
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                    FFFFFFF                    ","                    AAAAAAA                    ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                     V V V                     ","                     V V V                     ","                     V V V                     ","                   FFV V VFF                   ","                 AAAAV V VAAAA                 ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                     V V V                     ","                     I I I                     ","                     V V V                     ","                   FFV V VFF                   ","              AAAAAAAV V VAAAAAAA              ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                   FFF F FFF                   ","            AAAAAAAAAA   AAAAAAAAAA            ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                  FFFF F FFFF                  ","          AAAA   AAAAA   AAAAA   AAAA          ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                  FFFF F FFFF                  ","        AAAA     AAAAA   AAAAA     AAAA        ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                  FFFFFFFFFFF                  ","       AAA      AAAAAAAAAAAAAAA      AAA       ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                     D   D                     ","                  FFFFF FFFFF                  ","      AAA       AAAAAAAAAAAAAAA       AAA      ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                  DDDDE EDDDD                  ","                FFFFFFF FFFFFFF                ","     AAA        AAAAAAAAAAAAAAA        AAA     ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                DD   DE ED   DD                ","               FFFFFFD   DFFFFFF               ","     AA       AAAAAAAAAAAAAAAAAAA       AA     ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                     DE ED                     ","                     D   D                     ","               FFF           FFF               ","    AA       AAAAAAAAAAAAAAAAAAAAA       AA    ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                     DE ED                     ","                     DE ED                     ","                                               ","                                               ","    AA      AAAAAAAAAAAAAAAAAAAAAAA      AA    ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                                               ","                                               ","                                               ","   AA      AAAAAAAAAAAAAAAAAAAAAAAAA      AA   ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                    HDE EDH                    ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                                               ","                                               ","                                               ","                                               ","                                               ","   AA     AAAAAAAAAAAAAAAAAAAAAAAAAAA     AA   ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                  HH DE ED HH                  ","                                               ","                                               ","                                               ","                                               ","                     V V V                     ","                     V V V                     ","                     V V V                     ","                     V V V                     ","  AA     AAAAAAAAAAAAV V VAAAAAAAAAAAA     AA  ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                                               ","               E               E               ","               EHH           HHE               ","               E               E               ","               E               E               ","               E               E               ","               E               E               ","               E     V V V     E               ","               E     I I I     E               ","               E     V V V     E               ","         FF    E     V V V     E    FF         ","  AA     AAAAAAAAAAAAV V VAAAAAAAAAAAA     AA  ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                E             E                ","                E             E                ","                E             E                ","                E             E                ","                E             E                ","               HE             EH               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","         D                           D         ","        FFF          F F F          FFF        ","  AA  AAAAAAAAAAAAAAA     AAAAAAAAAAAAAAA  AA  ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                                               ","                                               ","                 E           E                 ","                 E           E                 ","                 E           E                 ","                 E           E                 ","                 E           E                 ","                                               ","                                               ","               H               H               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","         D                           D         ","        FFF          F F F          FFF        "," AAAAAAAAAAAAAAAAAAAA     AAAAAAAAAAAAAAAAAAAA ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                                               ","                                               ","                                               ","                                               ","                                               ","                   HH     HH                   ","                  E         E                  ","                  E         E                  ","                  E         E                  ","                  E         E                  ","                  E         E                  ","                  E         E                  ","                                               ","                                               ","                                               ","                                               ","                                               ","              H                 H              ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","        D                             D        ","    FFFFFF          FFFFFFF          FFFFFF    "," AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      FFF                      ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                   E       E                   ","                   E       E                   ","                   E       E                   ","                   E       E                   ","                   E       E                   ","                   E       E                   ","                   E       E                   ","                  HE       EH                  ","                   E       E                   ","                   E       E                   ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","              H                 H              ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","        D                             D        "," FFFFFFFFF         FFFFFFFFF         FFFFFFFFF "," AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                    .aisle("                      FFF                      ","                       E                       ","                       E                       ","                       E                       ","                       E                       ","                       E                       ","                     F   F                     ","                    E     E                    ","                    E     E                    ","                    E     E                    ","                    E     E                    ","                    E     E                    ","                    E     E                    ","                    E     E                    ","                    E     E                    ","                    E     E                    ","                                               ","                                               ","                      FFF                      ","                                               ","                                               ","                  H         H                  ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      FFF                      ","                                               ","                                               ","                                               ","                                               ","             H                   H             ","                                               ","                                               ","                                               ","                                               ","                      XXX                      ","                      X~X                      ","        D             XXX             D        ","FFFFFFFFFF        FFFFFFFFFFF        FFFFFFFFFF","AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA")
                    .aisle("                     F D F                     ","                       D                       ","                       D                       ","                       D                       ","                       D                       ","                       D                       ","                    F  D  F                    ","                       D                       ","                  D    D    D                  ","                  D    D    D                  ","                  D    D    D                  ","                  D    D    D                  ","                  D    D    D                  ","                  D    D    D                  ","                  D    D    D                  ","                 DD    D    DD                 ","                 D     D     D                 ","                 D     D     D                 ","                 D   F D F   D                 ","                 D     C     D                 ","                 D     C     D                 ","                 D     C     D                 ","                 D     C     D                 ","                DD     C     DD                ","                D      C      D                ","                D      C      D                ","                D      C      D                ","               DD      C      DD               ","               D     FDCDF     D               ","               D      DCD      D               ","              DD      DCD      DD              ","              D       DCD       D              ","              D       DCD       D              ","             DD      DDCDD      DD             ","             D       D C D       D             ","             D       D C D       D             ","            DD       D C D       DD            ","            D        D C D        D            "," VV        DD VV     XDCDX     VV DD        VV "," VI       DD  VI     XDCDX     IV  DD       IV "," VV    DDDD   VV     XDCDX     VV   DDDD    VV ","FVVFFFFFFD    VVFFFFFDDDDDFFFFFVV    DFFFFFFVVF","AVVAAAAAAAAAAAVV  AAAXXXXXAAA  VVAAAAAAAAAAAVVA")
                    .aisle("                    F     F                    ","                                               ","                                               ","                                               ","                                               ","                                               ","                   F       F                   ","                  E         E                  ","                  E         E                  ","                  E         E                  ","                  E         E                  ","                  E         E                  ","                  E         E                  ","                  E         E                  ","                 EE         EE                 ","                 EE         EE                 ","                 E           E                 ","                 E           E                 ","                 E  F     F  E                 ","                 E           E                 ","                 E           E                 ","                 E           E                 ","                EE           EE                ","                EE           EE                ","                E             E                ","                E             E                ","               EE             EE               ","               EE             EE               ","               E    FD   DF    E               ","              EE     D   D     EE              ","              EE     D   D     EE              ","              E      D   D      E              ","             EE      D   D      EE             ","             EE      D   D      EE             ","             E                   E             ","            EE                   EE            ","            EE                   EE            ","           EE                     EE           ","          EEE       XD   DX       EEE          ","         EEE        XD   DX        EEE         ","        EE          XD   DX          EE        ","F     FFF         FFFDDDDDFFF         FFF     F","A     AAAAAAAA    AAAXXXXXAAA    AAAAAAAA     A")
                    .aisle("                    FD   DF                    ","                    ED   DE                    ","                    ED   DE                    ","                    ED   DE                    ","                    ED   DE                    ","                    ED   DE                    ","                   F D   D F                   ","                     D   D                     ","                     D   D                     ","                     D   D                     ","                     D   D                     ","                     D   D                     ","                     D   D                     ","                     D   D                     ","                     D   D                     ","                     D   D                     ","                     D   D                     ","                     D B D                     ","                    FD - DF                    ","                     C - C                     ","                     C - C                     ","                     C - C                     ","                     C - C                     ","                     C - C                     ","                     C - C                     ","                     C - C                     ","                     C - C                     ","                     C - C                     ","                    FC - CF                    ","                     C - C                     ","                     C - C                     ","                     C - C                     ","                     C - C                     ","                     C - C                     ","                     C - C                     ","                     C - C                     ","                     C - C                     ","                     C - C                     "," VV           VV    XC - CX    VV           VV "," VI           VI    XC - CX    IV           IV "," VV           VV    XC - CX    VV           VV ","FVVFFFF       VVFFFFFDDDDDFFFFFVV       FFFFVVF","AVV   AAAAAAAAVV  AAAXXXXXAAA  VVAAAAAAAA   VVA")
                    .aisle("                    F     F                    ","                                               ","                                               ","                                               ","                                               ","                                               ","                   F       F                   ","                  E         E                  ","                  E         E                  ","                  E         E                  ","                  E         E                  ","                  E         E                  ","                  E         E                  ","                  E         E                  ","                 EE         EE                 ","                 EE         EE                 ","                 E           E                 ","                 E           E                 ","                 E  F     F  E                 ","                 E           E                 ","                 E           E                 ","                 E           E                 ","                EE           EE                ","                EE           EE                ","                E             E                ","                E             E                ","               EE             EE               ","               EE             EE               ","               E    FD   DF    E               ","              EE     D   D     EE              ","              EE     D   D     EE              ","              E      D   D      E              ","             EE      D   D      EE             ","             EE      D   D      EE             ","             E                   E             ","            EE                   EE            ","            EE                   EE            ","           EE                     EE           ","          EEE       XD   DX       EEE          ","         EEE        XD   DX        EEE         ","        EE          XD   DX          EE        ","F     FFF         FFFDDDDDFFF         FFF     F","A     AAAAAAAA    AAAXXXXXAAA    AAAAAAAA     A")
                    .aisle("                     F D F                     ","                       D                       ","                       D                       ","                       D                       ","                       D                       ","                       D                       ","                    F  D  F                    ","                       D                       ","                  D    D    D                  ","                  D    D    D                  ","                  D    D    D                  ","                  D    D    D                  ","                  D    D    D                  ","                  D    D    D                  ","                  D    D    D                  ","                 DD    D    DD                 ","                 D     D     D                 ","                 D     D     D                 ","                 D   F D F   D                 ","                 D     C     D                 ","                 D     C     D                 ","                 D     C     D                 ","                 D     C     D                 ","                DD     C     DD                ","                D      C      D                ","                D      C      D                ","                D      C      D                ","               DD      C      DD               ","               D     FDCDF     D               ","               D      DCD      D               ","              DD      DCD      DD              ","              D       DCD       D              ","              D       DCD       D              ","             DD      DDCDD      DD             ","             D       D C D       D             ","             D       D C D       D             ","            DD       D C D       DD            ","            D        D C D        D            "," VV        DD VV     XDCDX     VV DD        VV "," VI       DD  VI     XDCDX     IV  DD       IV "," VV    DDDD   VV     XDCDX     VV   DDDD    VV ","FVVFFFFFFD    VVFFFFFDDDDDFFFFFVV    DFFFFFFVVF","AVVAAAAAAAAAAAVV  AAAXXXXXAAA  VVAAAAAAAAAAAVVA")
                    .aisle("                      FFF                      ","                       E                       ","                       E                       ","                       E                       ","                       E                       ","                       E                       ","                     F   F                     ","                    E     E                    ","                    E     E                    ","                    E     E                    ","                    E     E                    ","                    E     E                    ","                    E     E                    ","                    E     E                    ","                    E     E                    ","                    E     E                    ","                                               ","                                               ","                      FFF                      ","                                               ","                                               ","                  H         H                  ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      FFF                      ","                                               ","                                               ","                                               ","                                               ","             H                   H             ","                                               ","                                               ","                                               ","                                               ","                      XXX                      ","                      XXX                      ","        D             XXX             D        ","FFFFFFFFFF        FFFFFFFFFFF        FFFFFFFFFF","AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      FFF                      ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                   E       E                   ","                   E       E                   ","                   E       E                   ","                   E       E                   ","                   E       E                   ","                   E       E                   ","                   E       E                   ","                  HE       EH                  ","                   E       E                   ","                   E       E                   ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","              H                 H              ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","        D                             D        "," FFFFFFFFF         FFFFFFFFF         FFFFFFFFF "," AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                                               ","                                               ","                                               ","                                               ","                                               ","                   HH     HH                   ","                  E         E                  ","                  E         E                  ","                  E         E                  ","                  E         E                  ","                  E         E                  ","                  E         E                  ","                                               ","                                               ","                                               ","                                               ","                                               ","              H                 H              ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","        D                             D        ","    FFFFFF          FFFFFFF          FFFFFF    "," AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                                               ","                                               ","                 E           E                 ","                 E           E                 ","                 E           E                 ","                 E           E                 ","                 E           E                 ","                                               ","                                               ","               H               H               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","         D                           D         ","        FFF          F F F          FFF        "," AAAAAAAAAAAAAAAAAAAA     AAAAAAAAAAAAAAAAAAAA ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                E             E                ","                E             E                ","                E             E                ","                E             E                ","                E             E                ","               HE             EH               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","         D                           D         ","        FFF          F F F          FFF        ","  AA  AAAAAAAAAAAAAAA     AAAAAAAAAAAAAAA  AA  ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                                               ","               E               E               ","               EHH           HHE               ","               E               E               ","               E               E               ","               E               E               ","               E               E               ","               E     V V V     E               ","               E     I I I     E               ","               E     V V V     E               ","         FF    E     V V V     E    FF         ","  AA     AAAAAAAAAAAAV V VAAAAAAAAAAAA     AA  ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                  HH DE ED HH                  ","                                               ","                                               ","                                               ","                                               ","                     V V V                     ","                     V V V                     ","                     V V V                     ","                     V V V                     ","  AA     AAAAAAAAAAAAV V VAAAAAAAAAAAA     AA  ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                    HDE EDH                    ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                                               ","                                               ","                                               ","                                               ","                                               ","   AA     AAAAAAAAAAAAAAAAAAAAAAAAAAA     AA   ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                     DE ED                     ","                     DE ED                     ","                     DE ED                     ","                                               ","                                               ","                                               ","   AA      AAAAAAAAAAAAAAAAAAAAAAAAA      AA   ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                     DE ED                     ","                     DE ED                     ","                                               ","                                               ","    AA      AAAAAAAAAAAAAAAAAAAAAAA      AA    ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                     DE ED                     ","                     D   D                     ","               FFF           FFF               ","    AA       AAAAAAAAAAAAAAAAAAAAA       AA    ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                      E E                      ","                DD   DE ED   DD                ","               FFFFFFD   DFFFFFF               ","     AA       AAAAAAAAAAAAAAAAAAA       AA     ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                  DDDDE EDDDD                  ","                FFFFFFF FFFFFFF                ","     AAA        AAAAAAAAAAAAAAA        AAA     ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                     D   D                     ","                  FFFFF FFFFF                  ","      AAA       AAAAAAAAAAAAAAA       AAA      ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                  FFFFFFFFFFF                  ","       AAA      AAAAAAAAAAAAAAA      AAA       ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                  FFFF F FFFF                  ","        AAAA     AAAAA   AAAAA     AAAA        ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                  FFFF F FFFF                  ","          AAAA   AAAAA   AAAAA   AAAA          ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                   FFF F FFF                   ","            AAAAAAAAAA   AAAAAAAAAA            ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                     V V V                     ","                     I I I                     ","                     V V V                     ","                   FFV V VFF                   ","              AAAAAAAV V VAAAAAAA              ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                     V V V                     ","                     V V V                     ","                     V V V                     ","                   FFV V VFF                   ","                 AAAAV V VAAAA                 ")
                    .aisle("                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                                               ","                    FFFFFFF                    ","                    AAAAAAA                    ")
                    .where(' ', any())
                    .where('-', air())
                    .where('~', selfPredicate())
                    .where('D', states(GTNEMetaBlock.ELEVATOR_CASING.getState(ElevatorCasing.CasingType.ELEVATOR_BASE_CASING)))
                    .where('F', states(GTNEMetaBlock.ELEVATOR_CASING.getState(ElevatorCasing.CasingType.ELEVATOR_INTERNAL_STRUCTURE)))
                    .where('E', states(GTNEMetaBlock.ELEVATOR_CASING.getState(ElevatorCasing.CasingType.ELEVATOR_SUPPORT_STRUCTURE)))
                    .where('A', states(GTNEMetaBlock.ELEVATOR_CASING.getState(ElevatorCasing.CasingType.HIGH_STRENGTH_CONCRETE)))
                    .where('B', states(GTNEMetaBlock.ELEVATOR_CASING.getState(ElevatorCasing.CasingType.ELEVATOR_CABLE)))
                    .where('H', frames(Neutronium))
                    .where('X', states(GTNEMetaBlock.ELEVATOR_CASING.getState(ElevatorCasing.CasingType.ELEVATOR_BASE_CASING)).or(abilities(MultiblockAbility.INPUT_ENERGY, MultiblockAbility.INPUT_LASER).setExactLimit(1)).or(abilities(MultiblockAbility.COMPUTATION_DATA_RECEPTION).setExactLimit(1)))
                    .where('C', elevatorMotors())
                    .where('I', modulePredicate())
                    .where('V', states(GTNEMetaBlock.ELEVATOR_CASING.getState(ElevatorCasing.CasingType.ELEVATOR_BASE_CASING)).or(abilities(MultiblockAbility.IMPORT_ITEMS,MultiblockAbility.IMPORT_FLUIDS,MultiblockAbility.EXPORT_FLUIDS,MultiblockAbility.EXPORT_ITEMS, MultiblockAbility.COMPUTATION_DATA_RECEPTION).setPreviewCount(0)))

                    .build();
        }
    }

    @Override
    public boolean hasMaintenanceMechanics() {
        return false;
    }

    @Override
    public ICubeRenderer getBaseTexture(IMultiblockPart iMultiblockPart) {
        return GTNETextures.ELEVATOR_CASING;
    }

    @SideOnly(Side.CLIENT)
    @NotNull
    @Override
    protected ICubeRenderer getFrontOverlay() {
        return Textures.DATA_BANK_OVERLAY;
    }

    @Override
    public void renderMetaTileEntity(CCRenderState renderState, Matrix4 translation, IVertexOperation[] pipeline) {
        super.renderMetaTileEntity(renderState, translation, pipeline);
        getFrontOverlay().renderOrientedState(renderState, translation, pipeline,
                getFrontFacing(), true, true);
    }

    @Override
    protected void formStructure(PatternMatchContext context) {
        super.formStructure(context);
        Object type = context.get("ElevatorMotorTier");
        if (type instanceof IElevatorMotorTier) {
            this.motorTier = ((IElevatorMotorTier) type).getTier() + 1;
        } else
            this.motorTier = 0;
    }

    @Override
    public void checkStructurePattern() {
        if (this.getOffsetTimer() % 100 == 0 || this.isFirstTick()) {
            if (!this.isStructureFormed()) {
                reinitializeStructurePattern();
            }
            super.checkStructurePattern();
        }
    }

    @Override
    public void invalidateStructure() {
        super.invalidateStructure();
        resetTileAbilities();
        this.spaceElevatorReceivers.forEach(ISpaceElevatorReceiver::sentWorkingDisabled);
        this.spaceElevatorReceivers.forEach(s -> s.setSpaceElevator(null));
    }

    protected void initializeAbilities() {
        List<IEnergyContainer> powerInput = new ArrayList<>(getAbilities(MultiblockAbility.INPUT_ENERGY));
        powerInput.addAll(getAbilities(MultiblockAbility.INPUT_LASER));
        this.energyContainer = new EnergyContainerList(powerInput);
        List<IOpticalComputationHatch> providers = getAbilities(MultiblockAbility.COMPUTATION_DATA_RECEPTION);
        if (providers != null && providers.size() >= 1) {
            this.computationProvider = providers.get(0);
        }
    }

    private void resetTileAbilities() {
        this.energyContainer = new EnergyContainerList(new ArrayList<>());
    }

    @NotNull
    protected TraceabilityPredicate modulePredicate() {
        return new TraceabilityPredicate(blockWorldState -> {
            IBlockState blockState = blockWorldState.getBlockState();
            Block block = blockState.getBlock();
            if (block instanceof ElevatorCasing) {
                ElevatorCasing.CasingType casingType = ((ElevatorCasing) blockState.getBlock()).getState(blockState);
                if (casingType == ElevatorCasing.CasingType.ELEVATOR_BASE_CASING)
                    return true;
            }

            TileEntity tileEntity = blockWorldState.getTileEntity();
            if (!(tileEntity instanceof IGregTechTileEntity))
                return false;

            MetaTileEntity metaTileEntity = ((IGregTechTileEntity) tileEntity).getMetaTileEntity();

            if (metaTileEntity instanceof ISpaceElevatorProvider)
                return false;

            if (!(metaTileEntity instanceof ISpaceElevatorReceiver))
                return false;

            ISpaceElevatorReceiver spaceElevatorReceiver = (ISpaceElevatorReceiver) metaTileEntity;
            if (spaceElevatorReceiver.getSpaceElevator() != this) {
                spaceElevatorReceiver.setSpaceElevator(this);
                this.spaceElevatorReceivers.add(spaceElevatorReceiver);
            }
            return true;
        });
    }

    @Override
    protected ModularUI createUI(EntityPlayer entityPlayer) {
        return createUITemplate(entityPlayer).build(getHolder(), entityPlayer);
    }

    protected ModularUI.Builder createUItemplate(EntityPlayer entityPlayer) {
        ModularUI.Builder builder = ModularUI.builder(GuiTextures.BACKGROUND, 198, 238);

        //Display
        builder.image(4, 4, 190, 139, GuiTextures.DISPLAY);

        builder.label(9, 9, getMetaFullName(), 0xFFFFFF);

        builder.widget(new AdvancedTextWidget(9, 20, this::addDisplayText, 0xFFFFFF)
                .setMaxWidthLimit(220)
                .setClickHandler(this::handleDisplayClick));

        //Extend Button
        builder.widget(new ImageCycleButtonWidget(173, 213, 18, 18, GTNETextures.BUTTON_ELEVATOR_EXTENSION,
                this::isExtended, this::setExtended).setTooltipHoverString("gtne.gui.multiblock.space_elevator_extended"));
        builder.widget(new ImageWidget(173, 201, 18, 6, GuiTextures.BUTTON_POWER_DETAIL));

        //Voiding Mode Button
        builder.widget(new ClickButtonWidget(173, 173, 18, 18, "", data -> enableAllModules())
                .setButtonTexture(GTNETextures.BUTTON_ENABLE_STATIC)
                .setTooltipText("gtne.gui.multiblock.space_elevator.enable_all_modules"));

        builder.widget(new ClickButtonWidget(173, 191, 18, 18, "", data -> disableAllModules())
                .setButtonTexture(GTNETextures.BUTTON_DISABLE_STATIC)
                .setTooltipText("gtne.gui.multiblock.space_elevator.disable_all_modules"));

        //Teleport Button
        if (Mods.GalacticraftCore.isModLoaded()) {
            builder.widget(new ClickButtonWidget(173, 155, 18, 18, "", data -> {
                if (entityPlayer instanceof EntityPlayerMP && this.isStructureFormed()) {
                    EntityPlayerMP player = (EntityPlayerMP) entityPlayer;

                    final GCPlayerStats stats = GCPlayerStats.get(player);
                    stats.setCoordsTeleportedFromX(player.posX);
                    stats.setCoordsTeleportedFromZ(player.posZ);

                    try {
                        WorldUtil.toCelestialSelection(player, stats, this.motorTier >= 3 ? 9 : 8);
                    } catch (final Exception e) {
                        e.printStackTrace();
                    }
                }
            }).setButtonTexture(GTNETextures.BUTTON_ELEVATOR_TELEPORT).setTooltipText("gtne.gui.multiblock.space_elevator_teleport"));
        }

        builder.bindPlayerInventory(entityPlayer.inventory, 155);
        return builder;

    }

    @Override
    protected void addDisplayText(List<ITextComponent> textList) {
        MultiblockDisplayText.builder(textList, this.isStructureFormed())
                .addCustom(textlist -> {
                    if (this.isStructureFormed()) {
                        textlist.add(TextComponentUtil.translationWithColor(TextFormatting.BLUE, "gtne.machine.space_elevator.motor_tier", this.motorTier));
                        textlist.add(TextComponentUtil.translationWithColor(TextFormatting.YELLOW, "gtne.machine.space_elevator.max_module", getMaxModules()));

                        if (this.spaceElevatorReceivers.isEmpty()) {
                            textlist.add(TextComponentUtil.translationWithColor(TextFormatting.RED, "gtne.machine.space_elevator.modules.none"));
                        } else {
                            textlist.add(TextComponentUtil.translationWithColor(getModuleCount() < getMaxModules() ? TextFormatting.AQUA : TextFormatting.YELLOW, "gtne.machine.space_elevator.total_modules", getModuleCount()));
                            textlist.add(TextComponentUtil.translationWithColor(TextFormatting.GREEN, "gtne.machine.space_elevator.modules"));
                            List<String> moduleNames = new ArrayList<>();
                            List<String> uniqueNames = new ArrayList<>();
                            this.spaceElevatorReceivers.forEach(s -> {
                                moduleNames.add(s.getNameForDisplayCount());
                                if (!uniqueNames.contains(moduleNames.get(moduleNames.indexOf(s.getNameForDisplayCount())))) {
                                    uniqueNames.add(s.getNameForDisplayCount());
                                }
                            });
                            uniqueNames.forEach(s -> textlist.add(TextComponentUtil.translationWithColor(TextFormatting.WHITE, s, Collections.frequency(moduleNames, s))));
                        }
                    }
                });
    }

    private boolean isExtended() {
        return this.isExtended;
    }

    private void setExtended(Boolean bool) {
        this.isExtended = bool;
        invalidateStructure();
        reinitializeStructurePattern();
    }

    @Override
    public NBTTagCompound writeToNBT(NBTTagCompound data) {
        data.setBoolean("extended", this.isExtended);
        return super.writeToNBT(data);
    }

    @Override
    public void readFromNBT(NBTTagCompound data) {
        super.readFromNBT(data);
        this.isExtended = data.getBoolean("extended");
    }

    @Override
    public void writeInitialSyncData(PacketBuffer buf) {
        super.writeInitialSyncData(buf);
        buf.writeBoolean(this.isExtended);
    }

    @Override
    public void receiveInitialSyncData(PacketBuffer buf) {
        super.receiveInitialSyncData(buf);
        this.isExtended = buf.readBoolean();
    }

    @Override
    public int getMotorTier() {
        return this.motorTier;
    }

    @Override
    public IEnergyContainer getEnergyContainerForModules() {
        return this.energyContainer;
    }

    @Override
    public boolean amIInTheList(ISpaceElevatorReceiver receiver) {
        return this.spaceElevatorReceivers.contains(receiver);
    }

    private int getMaxModules() {
        if (this.motorTier == 1)
            return 6;
        if (this.motorTier == 2)
            return 12;
        if (this.motorTier == 3 && this.isExtended)
            return 15;
        if (this.motorTier == 4 && this.isExtended)
            return 18;
        if (this.motorTier == 5 && this.isExtended)
            return 24;

        return 12;
    }

    private boolean checkModules() {
        return getModuleCount() <= getMaxModules();
    }

    private int getModuleCount() {
        return this.spaceElevatorReceivers.size();
    }

    private void disableAllModules() {
        this.spaceElevatorReceivers.forEach(ISpaceElevatorReceiver::sentWorkingDisabled);
    }

    private void enableAllModules() {
        this.spaceElevatorReceivers.forEach(ISpaceElevatorReceiver::sentWorkingEnabled);
    }

    @Override
    public IOpticalComputationProvider getComputationProvider() {
        return this.computationProvider;
    }

}
